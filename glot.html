<!DOCTYPE html>
<html>
<head>
	<!--
		This is a very early version of what will become WebGLot - a WebGL-
		based plotting library for mathematical primitives.
	-->
	<title>WebGLot Alpha</title>
	
	<!--
		This is a matrix library I have been using for the time being, though
		I may move to something more standard.  I originally got this code from
		http://webkit.org/blog/603/webgl-now-available-in-webkit-nightlies/
	-->
	<script src="CanvasMatrix.js"> </script>
	
	<!--
		These are the class files used in WebGLot. I'm not really an expert
		in JavaScript, and would prefer an analog to the #include macro in
		C++ for this task so that only one script must be included.  For the
		time being, just copy-and-paste this.
	-->
	<script src="emptytexture.js"> </script>
	<script src="texture.js">      </script>
	<script src="ray.js">          </script>
	<script src="primitive.js">    </script>
	<script src="datasurface.js">  </script>
	<script src="box.js">          </script>
	<script src="pde.js">          </script>
	<script src="sphere.js">       </script>
	<script src="stopwatch.js">    </script>
	<script src="screen.js">       </script>
	<script src="surface.js">      </script>
	<script src="p_surface.js">    </script>
	<script src="grapher.js">      </script>
	<script src="isosurface.js">   </script>

	<script>
	function keyboard(key_event) {
		var key = Number(key_event.keyCode);
		if (key == 65) {
			glot.set("alpha", glot.get("alpha") + 0.01);
			glot.display();
		} else if (key == 90) {
			glot.set("alpha", glot.get("alpha") - 0.01);
			glot.display();
		}	
	}
	
	var mySurface = null;
	
	function gen_isosurface(string) {
		if (mySurface) {
			glot.primitives.pop();
			mySurface = new isosurface(document.forms["function"].elements.fn.value);
			glot.add(mySurface);
		} else {
			mySurface = new isosurface(document.forms["function"].elements.fn.value);
			glot.add(mySurface);
		}
		glot.restart();
	}
	
	function start() {
		/* Instantiate a grapher
		 *
		 * In the C++ version, it's a singleton, and so it's possible that
		 * this interface will change, so use with caution.
		 */
		var glot = new grapher();
		
		glot.setKeyboardFunction(keyboard);
		
		glot.set("alpha", 1.5);
		
		glot.setDomain(-2, 2, -2, 2);
		
		// You can add new primitives to the display with the add function.
		
		// The unit sphere
		glot.add(new isosurface("sqrt(x * x + y * y + z * z)"));
		
		// The unit cylinder
		//glot.add(new isosurface("sqrt(x * x + y * y) - 1.0"));
		
		// A sinusodal lathe
		//glot.add(new isosurface("abs(sin(z - t)) - sqrt(x * x + y * y)"));
		
		//glot.add(new isosurface("1.0 - sin(z) + cos(sqrt(x * x + y * y + sin(t)))"));
		
		glot.add(new box());
				
		/* If you've got a function that's time-dependent and thus you'd like
		 * for it to animate, then call glot.run.  It makes sure it constantly
		 * refreshes, otherwise the plot will be interactive, but static.  Well,
		 * that is to say, it will only refresh when the perpective changes,
		 * like with zooming in and out, or rotating it.
		 */
		glot.run();
	}
	</script>
	
	<style type="text/css">
	canvas {
		border: 1px solid black;
		width:100%;
		height:80%;
	}
	</style>
</head>
<body onload="start()">
	<!--
		WebGLot currently requires there to be a canvas with id="glot" to work.
		This will likely remain the default behavior, but there may be a new 
		interface added so that drawing on multiple canvases can take place.
		Though, it's a long way down on the roadmap.
	-->
	<canvas id="glot">It seems you do not have support for WebGL.</canvas>
	
	<div id="function_form">
		<form name="function" onsubmit="gen_isosurface(); return false">
			f(x, y, z, t) = <input size='100' name="fn" /> = 0
		</form>
		<p><em>Note:</em> If you need to enter numerical constants, make sure they are written as floating-point numbers. Eg, 2.0, not 2</p>
	</div>
	
	<div id="framerate">Framerate: </div>
</body>
</html>
